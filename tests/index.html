<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Crunch - Tests</title>

  <script src="../crunch.js"></script>
  <script id="template-result" type="html/template">
    <li><dl><dt>Test #</dt><dd>{{number}}</dd><dt>Function:</dt><dd>{{func}}</dd><dt>Arguments:</dt>{{#args}}<dd>{{array}}</dd>{{/args}}<dt>Expected:</dt><dd>{{chck}}</dd><dt>Result:</dt><dd>{{result}}</dd><dt>Execution Time:</dt><dd>{{time}} ms</dd><dt>Outcome:</dt><dd>{{outcome}}</dd></dl></li>
  </script>
</head>
<body>

<ul id="results"></ul>

<script>

function TemplateEngine(templ) {
  if (typeof templ !== "undefined")
    templ = document.getElementById(templ).innerHTML.replace(/\n|\r/g, "").replace(/>\s+</g, "><").trim();

  return function compile(data, template) {
    var match, tpart, i;

    if (typeof template === "undefined")
      template = templ;

    while (match = /\{\{#([a-zA-Z]+)\}\}(.+)\{\{\/\1\}\}/g.exec(template)) {
      for (tpart = "", i = 0; i < data[match[1]].length; i++)
        tpart += compile(data[match[1]][i], match[2]);

      template = template.split(match[0]).join(tpart);
      delete data[match[1]];
    }

    if (Array.isArray(data))
      data = {"array": data};
    for (match in data)
      template = template.split("{{" + match + "}}").join(data[match]);

    return template;
  }
}

var result = TemplateEngine("template-result");

function Test(func, args, chck) {
  this.func = func;
  this.args = args;
  this.chck = chck;

  this.number;
  this.result;
  this.outcome;
  this.time;
}

Test.prototype.crunch = Crunch();

Test.prototype.verify = function() {
  if (this.result.length != this.chck.length)
    return false;

  for (var i = 0; i < this.result.length; i++)
    if (this.result[i] !== this.chck[i])
      return false;

  return true;
}

Test.prototype.run = function() {
  this.time = Date.now();
  this.result = this.crunch[this.func].apply(this.crunch, this.args);
  this.time = Date.now() - this.time;
  this.outcome = this.verify() ? "Success" : "Failure";
}

var tests = [];

/* BEGIN ADDITION SETUP */

tests.push(new Test("add", [[242, 62], [42, 2]], [1, 28, 64]));

tests.push(new Test("add", [[6, 17], [42, 2]], [48, 19]));

tests.push(new Test("add", [[26, 255, 230, 17], [42, 34]], [27, 0, 16, 51]));

tests.push(new Test("add", [[234, 34], [255, 255, 230, 17]], [1, 0, 0, 208, 51]));

tests.push(new Test("add", [[255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255]], [1, 255, 255, 255, 255, 255, 254]));

/* END ADDITION SETUP */
/* BEGIN SUBTRACTION SETUP */

tests.push(new Test("sub", [[242, 62], [42, 2]], [200, 60]));

tests.push(new Test("sub", [[26], [255]], [-229])); // failing - conversion of neg problem

tests.push(new Test("sub", [[170, 1, 79, 119, 242, 62], [17, 241, 123, 250, 42, 2]], [152, 15, 211, 125, 200, 60]));

tests.push(new Test("sub", [[240, 0, 0, 0, 0, 0], [1]], [239, 255, 255, 255, 255, 255]));

/* END SUBTRACTION SETUP */
/* BEGIN MULTIPLICATION SETUP */

tests.push(new Test("mul", [[242, 62], [42, 2]], [39, 192, 16, 124]));

tests.push(new Test("mul", [[162, 51, 95], [42, 18, 204]], [26, 168, 86, 115, 157, 180]));

tests.push(new Test("mul", [[255, 65, 34, 51, 95], [42, 18, 204]], [41, 243, 109, 152, 188, 115, 157, 180]));

tests.push(new Test("mul", [[77, 242, 62], [42, 2, 113, 43, 57, 65]], [12, 202, 124, 133, 146, 125, 36, 79, 190]));

tests.push(new Test("mul", [[255, 17, 162, 62], [255, 17, 162, 62]], [254, 36, 34, 110, 119, 14, 135, 4]));

tests.push(new Test("mul", [[255, 255, 255, 255], [255, 255, 255, 255]], [255, 255, 255, 254, 0, 0, 0, 1]));

tests.push(new Test("mul", [[60, 193, 71, 209], [93, 8, 143, 237]], [22, 20, 63, 73, 97, 149, 59, 125]));

/* END MULTIPLICATION SETUP */
/* BEGIN SQUARE SETUP */

tests.push(new Test("sqr", [[162, 62]], [102, 210, 135, 4]));

tests.push(new Test("sqr", [[255, 17, 162, 62]], [254, 36, 34, 110, 119, 14, 135, 4]));

/* END SQUARE SETUP */
/* BEGIN EXPONENTIATION SETUP */

tests.push(new Test("exp", [[2, 92, 160], [45], [188, 14, 2]], [58, 164, 236]));

tests.push(new Test("exp", [[2, 92, 160], [17, 190], [188, 14, 2]], [50, 49, 208]));

/* END EXPONENTIATION SETUP */

tests.forEach(function(test, number) {
  test.number = number + 1;
  test.run();

  document.getElementById("results").insertAdjacentHTML("beforeend", result(test));
})


/*

x = [0x025c];
y = [0x11ae];
z = [0xfc0e];
r = [0xa732];
w = mpi.exp(x, y, z);
printResult(w, r, true);

x = [0x006fc53];
y = [0x3, 0xadb6663];
z = [0x4, 0xac0ee49];
r = [0x3, 0x4ae12f5];
w = mpi.exp(x, y, z);
printResult(w, r, true);

x = [0x00018ee, 0x90ff6c3, 0x73e0ee4, 0xe3f0ad2];
y = [0x0010001];
z = [0x000abcd, 0xefabcde, 0xfabefab, 0xcdefdae];
r = [0x000785c, 0x3e0857f, 0x05d7524, 0xc5901c0];
w = mpi.exp(x, y, z);
printResult(w, r, true);

x = [0x00012, 0x3651498, 0x1436123, 0x5148afe, 0xff12378, 0x61319ab, 0xcde1387, 0x1461097, 0x4501981, 0x4986128, 0x971246a, 0xbedfefd, 0xbe12873, 0x6149147, 0x6139196, 0x21436af, 0xafabbbb, 0xe123670];
y = [0x0101];
z = [0x00087, 0x61234af, 0xe9872ac, 0xb32e890, 0x4718124, 0x617ff13, 0x6ac4eb6, 0x727153f, 0xea10947, 0x3267190, 0x0bbef14, 0x38fe981, 0x2fe5123, 0x7811238, 0x9712461, 0x2985712, 0x6129146, 0x5814612];
r = [0x00019, 0xf4e7ce5, 0xef7038f, 0xf3b6061, 0x2c82ab8, 0xfbf6841, 0xcdd9fe4, 0x4ceb6b1, 0xd636dfe, 0xd0e2578, 0x82d61e5, 0xbe1808d, 0x99110fe, 0x7ab4a22, 0xd00a2ab, 0x2c2444c, 0x7c814ac, 0xb086428];
w = mpi.exp(x, y, z);
printResult(w, r, true);

x = [500];
y = [257];
z = [0xf67, 0x8654b7a, 0x1953b7d];
r = [0xab1, 0xc5f5c2c, 0xfb02f31];
w = mpi.exp(x, y, z);
printResult(w, r, true);
/* END EXPONENTIATION TESTS */

/* BEGIN DIVISION TESTS
printSection("DIVISION TESTS");

x = [0x0aa9988];
y = [0x1144];
r = [0x09e1];
w = mpi.div(x, y);
printResult(w, r, true);

x = [0xaa998, 0x8776655];
y = [0x1144];
r = [0x0009e, 0x181ff09];
w = mpi.div(x, y);
printResult(w, r, true);

x = [0x349ba, 0x8170655];
y = [0x0131af7];
r = [0x2c0ea88];
w = mpi.div(x, y);
printResult(w, r, true);
/* END DIVISION TESTS */

/* BEGIN MODULO TESTS
printSection("MODULO TESTS");

x = [0x0aa9988];
y = [0x1144];
r = [0x08c4];
w = mpi.mod(x, y);
printResult(w, r, true);

x = [0xaa998, 0x8776655];
y = [0x1144];
r = [0x0ef1];
w = mpi.mod(x, y);
printResult(w, r, true);

x = [0x349ba, 0x8170655];
y = [0x0131af7];
r = [0x00aed1d];
w = mpi.mod(x, y);
printResult(w, r, true);

x = [0x0100];
y = [0x01f1];
r = [0x0100];
w = mpi.mod(x, y);
printResult(w, r, true);
/* END MODULO TESTS */

</script>

</body>
</html>