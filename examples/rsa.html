<html>
<head>
  <meta charset="utf-8">
  <title>Crunch - Examples - RSA</title>

  <script src="../crunch.js" type="text/javascript"></script>

  <style>
  	fieldset {
  		margin: 15px;
  		border: none;
  	}

  	fieldset.vertical>label {
  		float: left;
  		clear: left;
  		width: 50px;
  		padding-top: 4px;
  	}
  	
  	fieldset.vertical>input {
  		float: left;
  		width: 600px;
  	}

  	fieldset.vertical>span {
  		float: left;
  		width: 100px;
  		padding: 4px 10px;
  	}

  	fieldset.vertical>span.small {
  		float: left;
  		width: 350px;
  		padding: 4px 10px;
  		color: #999;
  	}
  </style>
</head>
<body>

<h1>Crunch RSA Example</h1>
<p>RSA is one of the first practicable public-key cryptosystems. In such a cryptosystem, the encryption key is public and differs from the decryption key which is kept secret. In RSA, this asymmetry is based on the practical difficulty of factoring the product of two large prime numbers.</p>
<p>In this example, the Crunch arbitrary percision arithmetic library is used to generate an RSA key-pair, and uses it to "encrypt" and "decrypt" data.</p>

<fieldset class="vertical">	
	<h2>Generate RSA Key-Pair</h2>
	<p>Select a key size and click Generate. Larger key sizes will take longer to generate the key pair. Once genereted, the key material will populate the fields below.</p>
	
	<label for="size">Size</label>
	<select id="size">
		<option value="128">128</option>
		<option value="256">256</option>
		<option value="512">512</option>
		<option value="1024" selected="selected">1024</option>
		<option value="1536">1536</option>
		<option value="2048">2048</option>
		<option value="4096">4096</option>
	</select>
	<button onclick="generateKey(document.getElementById('size').value)">Generate</button>
</fieldset>


<fieldset class="vertical">
	<h2>Private Key Material</h2>
	<label for="p">p</label><input type="text" name="p" id="p" readonly="readonly"><span id="p-time"></span><span class="small">crunch.nextPrime(<em>random N bit number</em>)</span>
	<label for="q">q</label><input type="text" name="q" id="q" readonly="readonly"><span id="q-time"></span><span class="small">crunch.nextPrime(<em>random N bit number</em>)</span>
	<label for="f">f</label><input type="text" name="f" id="f" readonly="readonly"><span id="f-time"></span><span class="small">crunch.mul(crunch.decrement(p), crunch.decrement(q))</span>
	<label for="d">d</label><input type="text" name="d" id="d" readonly="readonly"><span id="d-time"></span><span class="small">crunch.inv(e, f)</span>
	<label for="u">u</label><input type="text" name="u" id="u" readonly="readonly"><span id="u-time"></span><span class="small">crunch.inv(p, q)</span>
</fieldset>

<fieldset class="vertical">
	<h2>Public Key Material</h2>
	<label for="e">e</label><input type="text" name="e" id="e" readonly="readonly"><span id="e-time"></span><span class="small">crunch.nextPrime(<em>random N bit number</em>)</span>
	<label for="n">n</label><input type="text" name="n" id="n" readonly="readonly"><span id="n-time"></span><span class="small">crunch.mul(p, q)</span>
</fieldset>

<fieldset>
	<h2>Modular Exponentiation (Encyption/Decryption)</h2>
	<p>Once a key-pair is generated, you can test the encryption/decryption using the following fields. This actually does modular exponentiation, which is the basis of the RSA cryptosystem.</p>
	<input type="text" name="in" id="in" value="1,2,3,4,5,6,7,8" disabled="disabled">
	<button id="in-button" onclick="encrypt()" disabled="disabled">x ^ e mod n [Encrypt] &rarr;</button>
	<button id="out-button" onclick="decrypt()" disabled="disabled">&larr; x ^ d mod n [Decrypt]</button>
	<input type="text" name="out" id="out" disabled="disabled">
	<span id="c-time"></span>
	<p>The encryption is executed via the function <em>crunch.exp(x, e, n)</em> and decryption via <em>crunch.gar(x, p, q, d, u)</em>.</p>
</fieldset>

<p>The calculations on this page are executed sequentially. Because Crunch is web-worker enabled, some of the above operations could be parallelized for even better performance.</p>
<p>All numbers on this page are byte-arrays which represent multi-precision integers.</p>

<script type="text/javascript">
    var p, q, e, n, f, d, u, crunch = Crunch();

    function generateRandom(size) {
      var t = new Uint8Array(Math.ceil(size/8));

      (window.crypto || window.msCrypto).getRandomValues(t);

      return Array.prototype.slice.call(t);
    }

	function generateKey(size, a, b, c) {
		var t;

		if (typeof a === "undefined") {
			a = generateRandom(size/2);
			b = generateRandom(size/2);
			c = generateRandom(size/32);

			console.log(a,b,c);
		}

		t = performance.now();
		p = crunch.nextPrime(a);
		document.getElementById("p").value = p;
		document.getElementById("p-time").textContent = (performance.now() - t).toFixed(2) + ' ms';

		t = performance.now();
		q = crunch.nextPrime(b);
		document.getElementById("q").value = q;
		document.getElementById("q-time").textContent = (performance.now() - t).toFixed(2) + ' ms';
		
		t = performance.now();
		e = [1, 0, 1];//crunch.nextPrime(c);
		document.getElementById("e").value = e;
		document.getElementById("e-time").textContent = (performance.now() - t).toFixed(2) + ' ms';
		
		t = performance.now();
		n = crunch.mul(p, q);
		document.getElementById("n").value = n;
		document.getElementById("n-time").textContent = (performance.now() - t).toFixed(2) + ' ms';
		
		t = performance.now();
		f = crunch.mul(crunch.decrement(p), crunch.decrement(q));
		document.getElementById("f").value = f;
		document.getElementById("f-time").textContent = (performance.now() - t).toFixed(2) + ' ms';
		
		t = performance.now();
		d = crunch.cut(crunch.inv(e, f));
		document.getElementById("d").value = d;
		document.getElementById("d-time").textContent = (performance.now() - t).toFixed(2) + ' ms';
		
		t = performance.now();
		u = crunch.cut(crunch.inv(p, q));
        document.getElementById("u").value = u;
        document.getElementById("u-time").textContent = (performance.now() - t).toFixed(2) + ' ms';

        document.getElementById('in').disabled = false;
        document.getElementById('in-button').disabled = false;
	}

	function encrypt() {
		var t = performance.now();
		document.getElementById('out').value = crunch.exp(document.getElementById('in').value.split(',').map(function(v){return parseInt(v)}), e, n); 
		document.getElementById('in').value = '';
		document.getElementById("c-time").textContent = (performance.now() - t).toFixed(2) + ' ms';

		document.getElementById('in').disabled = true;
        document.getElementById('in-button').disabled = true;
        document.getElementById('out').disabled = false;
        document.getElementById('out-button').disabled = false;
	}

	function decrypt() {
		var t = performance.now();
		document.getElementById('in').value = crunch.gar(document.getElementById('out').value.split(',').map(function(v){return parseInt(v)}), p, q, d, u);
		document.getElementById('out').value = '';
		document.getElementById("c-time").textContent = (performance.now() - t).toFixed(2) + ' ms';

		document.getElementById('in').disabled = false;
        document.getElementById('in-button').disabled = false;
        document.getElementById('out').disabled = true;
        document.getElementById('out-button').disabled = true;
	}

	//generateKey(1024, [252, 12, 167, 119, 180, 126, 78, 247, 162, 255, 46, 104, 240, 184, 195, 112, 131, 235, 152, 123, 154, 86, 198, 161, 58, 48, 83, 144, 90, 61, 196, 16, 98, 133, 63, 71, 132, 114, 27, 101, 141, 181, 224, 0, 252, 206, 165, 170, 17, 13, 127, 124, 153, 91, 245, 102, 60, 187, 224, 106, 66, 74, 109, 156], [242, 124, 66, 125, 119, 90, 0, 50, 31, 183, 253, 242, 160, 107, 173, 143, 54, 30, 163, 198, 77, 216, 103, 127, 39, 70, 187, 121, 64, 134, 182, 32, 153, 183, 240, 81, 221, 8, 91, 231, 82, 212, 205, 22, 122, 107, 247, 100, 125, 142, 239, 227, 50, 252, 37, 145, 76, 12, 7, 89, 7, 240, 236, 15], [15, 143, 108, 247])
</script>

</body>
</html>