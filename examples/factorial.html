<html>
<head>
  <meta charset="utf-8">
  <title>Crunch - Examples - Factorial Web Worker</title>

  <script src="../crunch.js" type="text/javascript"></script>

  <style>
  	fieldset {
  		margin: 15px;
  		border: none;
  	}

    ol {
      font-family: mono;
      font-size: 0.85em;
      margin-top: 30px;
    }

    ol>li {
      margin-bottom: 4px;
    }
  </style>
</head>
<body>

<h1>Crunch Factorial Example</h1>
<p>In mathematics, the factorial of a non-negative integer n, denoted by n!, is the product of all positive integers less than or equal to n. For example: 5! = 5  x  4  x  3  x  2  x  1 = 120</p>

<fieldset>
  <h2>Calculate Factorial via Web Worker</h2>
  <p>Crunch is loaded as a web worker, <em>new Worker("crunch.js")</em>. Every calculation is requested with a message: <em>worker.postMessage({"func": "mul", "args": [iteration, result]})</em>.</p>
  <p>You can chose between the iterative and native implementation. The iterative will return a result at each step, and is slower as decimal conversions are done each time, or the native, which calculates the final result internally and returns it once done.</p>
  <input type="text" name="factorial" id="factorial" value="50">
  <button onclick="calcFactorial()" id="calc-factorial">! Iterative</button>
  <button onclick="calcFactorialNative()" id="calc-factorial-native">! Native</button>
  <ol id="worker-result"></ol>
  <p><em>Note:</em> In the iterative example, a lot of time is wasted in the decimal to byte-array conversion stage, which occurs between every calculation to display the result. This is obvious when comparing, for example, 500! via the two methods.</p>
</fieldset>

<p><a href="./">&laquo; Back to Examples</a></p>

<script>
  var worker = new Worker("../crunch.js");
  var native = new Worker("../crunch.js");
  var crunch = Crunch();
  var result, iteration, factorial;

  native.onmessage = function (e) {
    document.getElementById("worker-result").insertAdjacentHTML("beforeend", "<li>" + crunch.stringify(e.data) + "</li>");
    document.getElementById("calc-factorial-native").disabled = false;
  }

  function calcFactorialNative() {
    document.getElementById("worker-result").innerHTML = "";
    document.getElementById("calc-factorial-native").disabled = true;

    native.postMessage({"func": "factorial", "args": [document.getElementById("factorial").value.toString(10)]});
  }


  worker.onmessage = function (e) {
    result = e.data;
    document.getElementById("worker-result").insertAdjacentHTML("beforeend", "<li>" + crunch.stringify(result) + "</li>");
    window.scrollTo(0, document.body.offsetHeight);

    if (iteration <= factorial) {
      sendIteration();
    } else {
      document.getElementById("calc-factorial").disabled = false;
    }
  }

  function sendIteration() {
    worker.postMessage({"func": "mul", "args": [crunch.parse(iteration.toString(10)), result]});
    iteration++;
  }

  function calcFactorial() {
    result = [1];
    iteration = 1;
    factorial = document.getElementById("factorial").value;
    document.getElementById("worker-result").innerHTML = "";
    document.getElementById("calc-factorial").disabled = true;
    sendIteration();
  }

</script>

</body>
</html>